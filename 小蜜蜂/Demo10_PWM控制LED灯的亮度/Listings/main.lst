C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2023 15:17:09 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          
   5          sbit L1 = P0 ^ 0;
   6          sbit S7 = P3 ^ 0;
   7          
   8          void HC138(uchar channel)
   9          {
  10   1        switch(channel)
  11   1        {
  12   2          case 4:
  13   2            P2 = (P2 & 0x1f) | 0x80;
  14   2          break;
  15   2          case 5:
  16   2            P2 = (P2 & 0x1f) | 0xa0;
  17   2          break;
  18   2          case 6:
  19   2            P2 = (P2 & 0x1f) | 0xc0;
  20   2          break;
  21   2          case 7:
  22   2            P2 = (P2 & 0x1f) | 0xe0;
  23   2          break;
  24   2        }
  25   1      }
  26          
  27          // ===============定时器相关函数===============
  28          uchar count = 0;
  29          uchar pwm_duty = 0;
  30          void InitTimer0()
  31          {
  32   1        // 设置定时器工作模式，注意只能字节赋值
  33   1        TMOD = 0x01;
  34   1        // 设置计数初值
  35   1        // 每1us产生一次中断，一共产生一百次
  36   1        TH0 = (65535 - 100) / 256;
  37   1        TL0 = (65535 - 100) % 256;
  38   1        // 打开中断允许
  39   1        ET0 = 1;
  40   1        EA = 1;
  41   1      }
  42          
  43          void ServiceTimer0() interrupt 1
  44          {
  45   1        // 16位不会自动重装，需要手动重装
  46   1        TH0 = (65535 - 100) / 256;
  47   1        TL0 = (65535 - 100) % 256;
  48   1        
  49   1        count ++ ;
  50   1        
  51   1        if (count == pwm_duty)
  52   1        {
  53   2          L1 = 1;
  54   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2023 15:17:09 PAGE 2   

  55   1        else if (count == 100)
  56   1        {
  57   2          L1 = 0;
  58   2          count = 0;
  59   2        }
  60   1      }
  61          // ============================================
  62          
  63          // ===============按键相关函数===============
  64          void DelayK(uint t)  // 软件去抖动延时函数
  65          {
  66   1        while (t -- ) ;
  67   1      }
  68          
  69          uchar stat = 0;
  70          void ScanKeys()  // 按键扫描函数
  71          {
  72   1        if (S7 == 0)
  73   1        {
  74   2          DelayK(500);
  75   2          if (S7 == 0)
  76   2          {
  77   3            while (S7 == 0) ;
  78   3            switch(stat)
  79   3            {
  80   4              case 0:
  81   4                L1 = 0;
  82   4                TR0 = 1;
  83   4                pwm_duty = 10;
  84   4                stat = 1;
  85   4              break;
  86   4              
  87   4              case 1:
  88   4                pwm_duty = 50;
  89   4                stat = 2;
  90   4              break;
  91   4              
  92   4              case 2:
  93   4                pwm_duty = 90;
  94   4                stat = 3;
  95   4              break;
  96   4              
  97   4              case 3:
  98   4                L1 = 1;
  99   4                TR0 = 0;
 100   4                stat = 0;
 101   4              break;
 102   4            }
 103   3          }
 104   2        }
 105   1      }
 106          // ==========================================
 107          
 108          void main()
 109          {
 110   1        HC138(4);
 111   1        L1 = 1;
 112   1        InitTimer0();
 113   1        while(1)
 114   1        {
 115   2          ScanKeys();
 116   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2023 15:17:09 PAGE 3   

 117   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    191    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
